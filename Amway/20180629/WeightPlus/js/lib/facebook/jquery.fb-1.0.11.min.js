(function(a){typeof define==="function"&&define.amd?define(["jquery","extend"],a):a(jQuery)})(function(){var a=$.Deferred(),b=false;$.fb={api:function(){var e=this,d=Array.prototype.slice.call(arguments),b=$.Deferred(),c=d.concat([function(a){if((""+a).toLowerCase()=="true"||(""+a).toLowerCase()=="false")b.reject(a);else if(a.error&&a.error.message){console.log("fb.api",a.error.message);b.reject(a.error.message,a.error)}else b.resolve(a)}]);a.done(function(){FB.api.apply(FB,c)});return b.promise()},fql:function(a){return this.api("fql",{q:a})},login:function(c){var b=$.Deferred();a.done(function(){FB.login(function(a){if(a.authResponse&&a.status=="connected")b.resolve(a.authResponse.userID,a.authResponse.accessToken,a);else b.reject(a)},c)});return b.promise()},ui:function(c){var b=$.Deferred();a.done(function(){FB.ui(c,function(a){if(a!=null){if(c.method=="apprequests")if(!a.to)return b.reject();b.resolve(a)}else b.reject()})});return b.promise()},getLoginStatus:function(){var b=$.Deferred();a.done(function(){FB.getLoginStatus(function(a){if(a.authResponse&&a.status=="connected"){$("form[signedRequest]").each(function(c,b){var a=$(b).find('input[name="SignedRequest"]');if(a.length==0)$('<input type="hidden" name="SignedRequest" />').val(FB.getAuthResponse().signedRequest).appendTo(b);else a.val(FB.getAuthResponse().signedRequest)});b.resolve(a.authResponse.userID,a.authResponse.accessToken,a)}else b.reject(a)})});return b.promise()},post:function(e,a,d,c){a=$.extend(a||{},{signedRequest:FB.getAuthResponse().signedRequest});var b=$.post(e,a,d);!c&&b.fail(function(){alert("\u4f3a\u670d\u5668\u5fd9\u788c\u4e2d\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\u3002")});return b},"get":function(e,a,d,c){a=$.extend(a||{},{signedRequest:FB.getAuthResponse().signedRequest});var b=$.get(e,a,d);!c&&b.fail(function(){alert("\u4f3a\u670d\u5668\u5fd9\u788c\u4e2d\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\u3002")});return b},init:function(d){if(b)return a.promise();b=true;var e=$.extend({appId:window.CONST?CONST.appID:undefined,status:true,cookie:true,xfbml:true,oauth:true},d);$("body").prepend('<div id="fb-root"></div>');window.fbAsyncInit=function(){d!==false&&FB.init(e);a.resolve(e)};var c=document.createElement("script");c.async=true;c.src=document.location.protocol+"//connect.facebook.net/zh_TW/all.js";document.getElementById("fb-root").appendChild(c);return a.promise()},share:function(a){window.open("https://www.facebook.com/share.php?u="+encodeURIComponent(a),"fbsharer","status = 1, height = 325, width = 580, resizable = 0")},feed:function(b,a,d,e,c){var f=window.CONST?CONST.inFbApp:/FBIOS/i.test(navigator.userAgent)||/(android)/i.test(navigator.userAgent)&&/FBAV/i.test(navigator.userAgent);function g(){FB.ui({method:"feed",name:e?e:$('meta[property="og:title"]').attr("content"),description:c?c:$('meta[property="og:description"]').attr("content"),picture:d?$.static(d):$('meta[property="og:image"]').attr("content"),caption:location.hostname,link:b?b:location.href},function(){if(a)location.href=a;else $.isFunction(a)&&a()})}if(!$.isMobile||f&&$.isIOS)g();else g()}}})