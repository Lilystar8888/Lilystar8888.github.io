(function(n){typeof define=="function"&&define.amd?define(["jquery","extend","fb","lightbox"],n):n(jQuery)})(function(){function r(){window.ga?ga.apply(null,["send","event"].concat(n.ga.befan)):window._gaq?_gaq.push(["_trackEvent"].concat(n.ga.befan)):""}function u(r){n=$.extend({},$.fb.fansPage.settings,r);FB.Event.subscribe("edge.create",function(){$("#"+t).lightbox("hide")});i=!0}function f(){var i=$('<div id="'+t+'" style="display:none"><h2 class="pageFansDlg_h2"><span>'+n.title+'<\/span><\/h2><div class="pageFansDlg_div_1"><div class="pageFansDlg_div_1_1"><div class="fb-like-box" data-href="'+n.pageURL+'" data-height="'+n.height+'" data-width="'+n.width+'" data-show-faces="false" data-stream="false" data-header="false"><\/div><\/div><\/div><\/div>');if(n["class"]!="")i.css({width:n.width+25+"px",position:"relative"}).addClass(n["class"]);else return $("#StylePageFansDlg").length==0&&$('<style type="text/css" id="StylePageFansDlg">\r\n.pageFansDlg {\r\nborder: 10px solid #666; border:10px solid rgba(82, 82, 82, 0.698);\r\ndirection: ltr;\r\nfont-family: "lucida grande",tahoma,verdana,arial,sans-serif";\r\n-moz-border-radius: 8px;\r\n-webkit-border-radius: 8px;\r\n}\r\n.pageFansDlg .pageFansDlg_h2 {\r\ncolor: #fff;\r\nbackground-color: #6d84b4;\r\nfont-size: 15px;\r\nfont-weight: bold;\r\nborder-bottom: medium none;\r\nborder-left: #3b5998 1px solid;\r\nborder-right: #3b5998 1px solid;\r\nborder-top: #3b5998 1px solid;\r\nmargin: 0px;\r\npadding: 0px;\r\nwidth: auto;\r\n}\r\n.pageFansDlg .pageFansDlg_h2 span {\r\ndisplay: block;\r\npadding-left: 10px;\r\npadding-right: 10px;\r\npadding-top: 5px;\r\npadding-bottom: 5px;\r\n}\r\n.pageFansDlg .pageFansDlg_div_1 {\r\nbackground-color: #fff;\r\nborder-bottom: #555 1px solid;\r\nborder-left: #555 1px solid;\r\nborder-right: #555 1px solid;\r\nborder-top: #555 1px solid;\r\n}\r\n.pageFansDlg .pageFansDlg_div_1_1 {\r\npadding: 0px;\r\nborder-bottom: #ccc 1px solid;\r\n}\r\n<\/style>').appendTo("head"),i.css({width:n.width+25+"px",position:"relative"}).addClass("pageFansDlg"),$("body").append(i),FB.XFBML.parse(),i}var t="FansPageLightbox",i=!1,n;$.fb.fansPage=function(t){if(!i)return u(t);var e=$.Deferred();return $.loading(500),$.fb.api(FB.getUserID()+"/likes/?limit=5000").done(function(t){function u(t){return $(t).map(function(){if(this.id==n.pageID)return!0}).length>0}if($.loading("hide"),t.data&&u(t.data))e.resolve();else{var i=f(),o=!1,s=null;n.autoSkipMS>0&&(s=setTimeout(function(){o=!0;i.lightbox("hide")},n.autoSkipMS));i.lightbox({overlayBgColor:n.overlayBgColor,onOverlayEvent:$.noop,overlayOpacity:n.overlayOpacity,zIndex:n.zIndex,width:n.width,height:n.height,onShow:n.onShow,onHide:function(){if(clearTimeout(s),i.remove(),o){r();n.onHide(!0);e.resolve()}else $.loading(500),$.fb.api(FB.getUserID()+"/likes/?limit=5000").done(function(t){if($.loading("hide"),t.data&&u(t.data)){r();n.onHide(!0);e.resolve()}else{n.onHide(!1);e.reject()}})}})}}).fail(function(){$.loading("hide");e.reject()}),e.promise()};n=$.fb.fansPage.settings={pageID:"",pageURL:"",title:"請先加入粉絲團","class":"",overlayBgColor:"#000",overlayOpacity:.7,zIndex:89999999,width:270,height:62,autoSkipMS:0,ga:{befan:["fb","be.fan",""]},onShow:function(){},onHide:function(){}}});