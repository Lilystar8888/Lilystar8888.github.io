(function(n){typeof define=="function"&&define.amd?define(["jquery","caman_base"],n):n(jQuery)})(function(){var n=null;Caman.prototype.backup=function(){n=this.context.getImageData(0,0,this.canvas.width,this.canvas.height)};Caman.prototype.restore=function(){this.context.putImageData(n,0,0);this.reloadCanvasData()};Caman.prototype.execHistory=function(n,t){var i=this;$(n).each(function(n,t){i[t.api].apply(i,t.params)});i.render(t)};Caman.Filter.register("ColorMatrixFilter",function(n){var t,i,r,u,f=n[0],e=n[1],o=n[2],s=n[3],h=n[4],c=n[5],l=n[6],a=n[7],v=n[8],y=n[9],p=n[10],w=n[11],b=n[12],k=n[13],d=n[14],g=n[15],nt=n[16],tt=n[17],it=n[18],rt=n[19];return this.process("ColorMatrixFilter",function(n){return t=n.r,i=n.g,r=n.b,u=n.a,n.r=t*f+i*e+r*o+u*s+h,n.g=t*c+i*l+r*a+u*v+y,n.b=t*p+i*w+r*b+u*k+d,n.a=t*g+i*nt+r*tt+u*it+rt,n})});window.ColorMatrix=function(){function n(){this.copyMatrix(n.IDENTITY_MATRIX)}return n.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],n.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],n.LENGTH=n.IDENTITY_MATRIX.length,n.prototype.adjustBrightness=function(n){return n==0||isNaN(n)?this:(n=this._cleanValue(n,255),this._multiplyMatrix([1,0,0,0,n,0,1,0,0,n,0,0,1,0,n,0,0,0,1,0,0,0,0,0,1]),this)},n.prototype.adjustContrast=function(t){if(t==0||isNaN(t))return this;t=this._cleanValue(t,100);var i;return t<0?i=127+t/100*127:(i=t%1,i=i==0?n.DELTA_INDEX[t]:n.DELTA_INDEX[t<<0]*(1-i)+n.DELTA_INDEX[(t<<0)+1]*i,i=i*127+127),this._multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1]),this},n.prototype.adjustSaturation=function(n){if(n==0||isNaN(n))return this;n=this._cleanValue(n,100);var t=1+(n>0?3*n/100:n/100),i=.3086,r=.6094,u=.082;return this._multiplyMatrix([i*(1-t)+t,r*(1-t),u*(1-t),0,0,i*(1-t),r*(1-t)+t,u*(1-t),0,0,i*(1-t),r*(1-t),u*(1-t)+t,0,0,0,0,0,1,0,0,0,0,0,1]),this},n.prototype.adjustHue=function(n){if(n==0||isNaN(n))return this;n=this._cleanValue(n,180)/180*Math.PI;var t=Math.cos(n),i=Math.sin(n),r=.213,u=.715,f=.072;return this._multiplyMatrix([r+t*(1-r)+i*-r,u+t*-u+i*-u,f+t*-f+i*(1-f),0,0,r+t*-r+i*.143,u+t*(1-u)+i*.14,f+t*-f+i*-.283,0,0,r+t*-r+i*-(1-r),u+t*-u+i*u,f+t*(1-f)+i*f,0,0,0,0,0,1,0,0,0,0,0,1]),this},n.prototype.copyMatrix=function(t){for(var r=n.LENGTH,i=0;i<r;i++)this[i]=t[i];return this},n.prototype.toArray=function(){for(var i=[],t=0,r=n.LENGTH;t<r;t++)i[t]=this[t];return i},n.prototype._multiplyMatrix=function(n){for(var t,u,i,f=[],r=0;r<5;r++){for(t=0;t<5;t++)f[t]=this[t+r*5];for(t=0;t<5;t++){for(u=0,i=0;i<5;i++)u+=n[t+i*5]*f[i];this[t+r*5]=u}}},n.prototype._cleanValue=function(n,t){return Math.min(t,Math.max(-t,n))},n}();Caman.Filter.register("brightness",function(n){return this.ColorMatrixFilter((new ColorMatrix).adjustBrightness(n))});Caman.Filter.register("contrast",function(n){return this.ColorMatrixFilter((new ColorMatrix).adjustContrast(n))});Caman.Filter.register("saturation",function(n){return this.ColorMatrixFilter((new ColorMatrix).adjustSaturation(n))});Caman.Filter.register("hue",function(n){return this.ColorMatrixFilter((new ColorMatrix).adjustHue(n))});Caman.Plugin.register("ConvolutionFilter",function(n,t,i){for(var r,e,h,o=JSON.parse(JSON.stringify(this.pixelData)),l=Math.floor(n.length/2),a=0,v=1,y=2,p=3,u=0,s=0,c=this.width,d=this.height,s=0;s<d;s++)for(u=0;u<c;u++){var f=(s*c+u)*4,w=0,b=0,k=0;for(r in n)for(e in n[r])h=((s+(r-l))*c+(u+(e-l)))*4,w+=o[h+a]*n[r][e],b+=o[h+v]*n[r][e],k+=o[h+y]*n[r][e];this.pixelData[f+a]=t*w+i;this.pixelData[f+v]=t*b+i;this.pixelData[f+y]=t*k+i;this.pixelData[f+p]=o[f+p]}return this});Caman.Filter.register("ConvolutionFilter",function(){return this.processPlugin("ConvolutionFilter",Array.prototype.slice.call(arguments,0))});Caman.Filter.register("radialBlur2",function(n){var t=$.extend({},n);typeof t.size!="undefined"&&(t.size=this.width/2*(t.size/100));t.center&&typeof t.center.x!="undefined"&&(t.center.x=this.width*(t.center.x/100));t.center&&typeof t.center.y!="undefined"&&(t.center.y=this.height*(t.center.y/100));typeof t.focusWidth!="undefined"&&(t.focusWidth=this.width*3*(t.focusWidth/100));this.radialBlur(t)});Caman.Filter.register("tiltShift2",function(n){var t=$.extend({},n);t.center&&typeof t.center.x!="undefined"&&(t.center.x=this.width*(t.center.x/100));t.center&&typeof t.center.y!="undefined"&&(t.center.y=this.height*(t.center.y/100));typeof t.focusWidth!="undefined"&&(t.focusWidth=this.width*3*(t.focusWidth/100));this.tiltShift(t)});Caman.Filter.register("vignette2",function(n,t){this.vignette(""+n+"%",t)});Caman.Plugin.register("mosaic",function(n){function u(n,t,i){return n*t+(1-n)*i}for(var f=0,t=this.pixelData,c=t.length;f<c>>2;f++){var r=f<<2,e={r:t[r],g:t[r+1],b:t[r+2]},i=r>>2,o=Math.floor(i/this.width),s=o%n,l=i-o*this.width,h=l%n;s&&(i-=s*this.width);h&&(i-=h);i=i<<2;t[r]=u(1,t[i],e.r);t[r+1]=u(1,t[i+1],e.g);t[r+2]=u(1,t[i+2],e.b)}return this});Caman.Filter.register("mosaic",function(){return this.processPlugin("mosaic",Array.prototype.slice.call(arguments,0))});Caman.Filter.register("sketch",function(){return this.greyscale().stackBlur(2).contrast(40).ConvolutionFilter([[0,20,0],[20,-80,20],[0,20,0]],1,0).invert()})});