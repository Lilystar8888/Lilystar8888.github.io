(function(a){typeof define==="function"&&define.amd?define(["jquery","extend"],a):a(jQuery)})(function(){function b(b){var a=b.find("[required]").map(function(){var a=$(this);if(a.is(":checkbox")){if(!a.is(":checked"))return a.data("label")}else if(a.is(":radio")){if(b.find("input[name="+a.attr("name")+"]:checked").length==0)return a.data("label")}else if($.trim(a.val())=="")return a.data("label")}).get();if(a.length)return!!alert($.fn.send.settings.errorTitle+"\uff1a\n"+a.join("\n"));a=b.find("[pattern]").map(function(){var b=new RegExp($(this).attr("pattern")),a=$(this);if(a.val()!=""&&!b.test(a.val()))return $(this).data("message").replace(/\{label\}/g,a.data("label"))}).get();return a.length?!!alert(a.join("\n")):true}$.fn.send=function(e){var d=this.is("form")?this:this.closest("form");if(!(d.length||(d=$("form:eq(0)")).length))return $.Deferred().reject();e=e||function(){return true};if(b(d)&&e()){if(window.FB&&FB.getAccessToken()){var g=d.find('input[name="SignedRequest"]');if(g.length==0)$('<input type="hidden" name="SignedRequest" />').val(FB.getAuthResponse().signedRequest).appendTo(d);else g.val(FB.getAuthResponse().signedRequest)}var f=$.callAPI(d.attr("action"),d.serialize());if($(".x-captcha").length>0){var c=$.Deferred();f.done(function(b){if(b.message=="Invalid Captcha"){a();c.reject.apply(c,["\u9a57\u8a3c\u78bc\u4e0d\u6b63\u78ba!"].concat(Array.prototype.slice.call(arguments,1)));return}c.resolve.apply(c,Array.prototype.slice.call(arguments,0))}).fail(function(){a();c.reject.apply(c,Array.prototype.slice.call(arguments,0))});f=c}return f}else return $.Deferred().reject()};$.fn.send.settings={errorTitle:"\u4e0b\u5217\u9805\u76ee\u5c1a\u672a\u586b\u5beb\uff0c\u8acb\u91cd\u65b0\u8f38\u5165"};function a(){var a=$(".x-captcha").attr("src");$(".x-captcha").attr("src",a.substr(0,a.indexOf("&t=")+3)+(new Date).getTime());$(".x-captcha-code").val("")}$(".x-captcha-refresh").on("click",a)})