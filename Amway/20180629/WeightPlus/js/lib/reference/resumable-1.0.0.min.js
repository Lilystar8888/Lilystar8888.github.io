(function(a){typeof define==="function"&&define.amd?define(["jquery","extend"],a):a(jQuery)})(function(){(function(){"use strict";var a=function(i){if(!(this instanceof a))return new a(i);this.version=1;this.support=typeof File!=="undefined"&&typeof Blob!=="undefined"&&typeof FileList!=="undefined"&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||false);if(!this.support)return false;var b=this;b.files=[];b.defaults={chunkSize:1*1024*1024,forceChunkSize:false,simultaneousUploads:3,fileParameterName:"file",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",prioritizeFirstAndLastChunk:false,target:"/",testChunks:true,generateUniqueIdentifier:null,maxChunkRetries:undefined,chunkRetryInterval:undefined,permanentErrors:[404,415,500,501],maxFiles:undefined,withCredentials:false,xhrTimeout:0,maxFilesErrorCallback:function(){var a=b.getOpt("maxFiles");alert("Please upload "+a+" file"+(a===1?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(a){alert(a.fileName||a.name+" is too small, please upload files larger than "+c.formatSize(b.getOpt("minFileSize"))+".")},maxFileSize:undefined,maxFileSizeErrorCallback:function(a){alert(a.fileName||a.name+" is too large, please upload files less than "+c.formatSize(b.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(a){alert(a.fileName||a.name+" has type not allowed, please upload files of type "+b.getOpt("fileType")+".")}};b.opts=i||{};b.getOpt=function(d){var b=this;if(d instanceof Array){var g={};c.each(d,function(a){g[a]=b.getOpt(a)});return g}if(b instanceof e)if(typeof b.opts[d]!=="undefined")return b.opts[d];else b=b.fileObj;if(b instanceof f)if(typeof b.opts[d]!=="undefined")return b.opts[d];else b=b.resumableObj;if(b instanceof a)return typeof b.opts[d]!=="undefined"?b.opts[d]:b.defaults[d]};b.events=[];b.on=function(c,a){b.events.push(c.toLowerCase(),a)};b.fire=function(){for(var c=[],a=0;a<arguments.length;a++)c.push(arguments[a]);for(var d=c[0].toLowerCase(),a=0;a<=b.events.length;a+=2){b.events[a]==d&&b.events[a+1].apply(b,c.slice(1));b.events[a]=="catchall"&&b.events[a+1].apply(null,c)}d=="fileerror"&&b.fire("error",c[2],c[1]);d=="fileprogress"&&b.fire("progress")};var c={stopEvent:function(a){a.stopPropagation();a.preventDefault()},each:function(b,c){if(typeof b.length!=="undefined"){for(var a=0;a<b.length;a++)if(c(b[a])===false)return}else for(a in b)if(c(a,b[a])===false)return},generateUniqueIdentifier:function(a){var c=b.getOpt("generateUniqueIdentifier");if(typeof c==="function")return c(a);var d=a.webkitRelativePath||a.fileName||a.name,e=a.size;return e+"-"+d.replace(/[^0-9a-zA-Z_-]/img,"")},contains:function(b,d){var a=false;c.each(b,function(b){if(b==d){a=true;return false}return true});return a},formatSize:function(a){return a<1024?a+" bytes":a<1024*1024?(a/1024).toFixed(0)+" KB":a<1024*1024*1024?(a/1024/1024).toFixed(1)+" MB":(a/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(c){var a=b.getOpt("target");if(a.indexOf("?")<0)a+="?";else a+="&";return a+c.join("&")}},h=function(a){c.stopEvent(a);d(a.dataTransfer.files,a)},g=function(a){a.preventDefault()},d=function(e,g){var d=0,a=b.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(typeof a.maxFiles!=="undefined"&&a.maxFiles<e.length+b.files.length)if(a.maxFiles===1&&b.files.length===1&&e.length===1)b.removeFile(b.files[0]);else{a.maxFilesErrorCallback(e,d++);return false}var h=[];c.each(e,function(e){var i=e.name.split("."),j=i[i.length-1].toLowerCase();if(a.fileType.length>0&&!c.contains(a.fileType,j)){a.fileTypeErrorCallback(e,d++);return false}if(typeof a.minFileSize!=="undefined"&&e.size<a.minFileSize){a.minFileSizeErrorCallback(e,d++);return false}if(typeof a.maxFileSize!=="undefined"&&e.size>a.maxFileSize){a.maxFileSizeErrorCallback(e,d++);return false}!b.getFromUniqueIdentifier(c.generateUniqueIdentifier(e))&&(function(){var a=new f(b,e);window.setTimeout(function(){b.files.push(a);h.push(a);a.container=typeof g!="undefined"?g.srcElement:null;b.fire("fileAdded",a,g)},0)})()});window.setTimeout(function(){b.fire("filesAdded",h)},0)};function f(f,b){var a=this;a.opts={};a.getOpt=f.getOpt;a._prevProgress=0;a.resumableObj=f;a.file=b;a.fileName=b.fileName||b.name;a.size=b.size;a.relativePath=b.webkitRelativePath||a.fileName;a.uniqueIdentifier=c.generateUniqueIdentifier(b);a._pause=false;a.container="";a.startchunkindex=0;var d=false,g=function(c,b){switch(c){case"progress":a.resumableObj.fire("fileProgress",a);break;case"error":a.abort();d=true;a.chunks=[];a.resumableObj.fire("fileError",a,b);break;case"success":if(d)return;a.resumableObj.fire("fileProgress",a);a.isComplete()&&a.resumableObj.fire("fileSuccess",a,b);break;case"retry":a.resumableObj.fire("fileRetry",a)}};a.chunks=[];a.abort=function(){var b=0;c.each(a.chunks,function(a){if(a.status()=="uploading"){a.abort();b++}});b>0&&a.resumableObj.fire("fileProgress",a)};a.cancel=function(){var b=a.chunks;a.chunks=[];c.each(b,function(b){if(b.status()=="uploading"){b.abort();a.resumableObj.uploadNextChunk()}});a.resumableObj.removeFile(a);a.resumableObj.fire("fileProgress",a)};a.retry=function(){a.bootstrap();var b=false;a.resumableObj.on("chunkingComplete",function(){!b&&a.resumableObj.upload();b=true})};a.bootstrap=function(){a.abort();d=false;a.chunks=[];a._prevProgress=0;for(var f=a.getOpt("forceChunkSize")?Math.ceil:Math.floor,c=Math.max(f(a.file.size/a.getOpt("chunkSize")),1),b=0;b<c;b++)(function(b){window.setTimeout(function(){a.chunks.push(new e(a.resumableObj,a,b,g));a.resumableObj.fire("chunkingProgress",a,b/c)},0)})(b);window.setTimeout(function(){a.resumableObj.fire("chunkingComplete",a)},0)};a.progress=function(){if(d)return 1;var b=0,e=false;c.each(a.chunks,function(c){if(c.status(a.startchunkindex)=="error")e=true;b+=c.progress(true,a.startchunkindex)});b=e?1:b>.999?1:b;b=Math.max(a._prevProgress,b);a._prevProgress=b;return b};a.isUploading=function(){var b=false;c.each(a.chunks,function(a){if(a.status()=="uploading"){b=true;return false}});return b};a.isComplete=function(){var b=false;c.each(a.chunks,function(c){var a=c.status();if(a=="pending"||a=="uploading"||c.preprocessState===1){b=true;return false}});return!b};a.pause=function(b){if(typeof b==="undefined")a._pause=a._pause?false:true;else a._pause=b};a.isPaused=function(){return a._pause};a.resumableObj.fire("chunkingStart",a);a.bootstrap();return this}function e(e,d,g,f){var a=this;a.opts={};a.getOpt=e.getOpt;a.resumableObj=e;a.fileObj=d;a.fileObjSize=d.size;a.fileObjType=d.file.type;a.offset=g;a.callback=f;a.lastProgressCallback=new Date;a.tested=false;a.retries=0;a.pendingRetry=false;a.preprocessState=0;var b=a.getOpt("chunkSize");a.loaded=0;a.startByte=a.offset*b;a.endByte=Math.min(a.fileObjSize,(a.offset+1)*b);if(a.fileObjSize-a.endByte<b&&!a.getOpt("forceChunkSize"))a.endByte=a.fileObjSize;a.xhr=null;a.test=function(){a.xhr=new XMLHttpRequest;var e=function(){a.tested=true;var b=a.status();if(b=="success"){a.callback(b,a.message());a.resumableObj.uploadNextChunk()}else a.send()};a.xhr.addEventListener("load",e,false);a.xhr.addEventListener("error",e,false);var b=[],d=a.getOpt("query");if(typeof d=="function")d=d(a.fileObj,a);c.each(d,function(a,c){b.push([encodeURIComponent(a),encodeURIComponent(c)].join("="))});b.push(["resumableChunkNumber",encodeURIComponent(a.offset+1)].join("="));b.push(["resumableChunkSize",encodeURIComponent(a.getOpt("chunkSize"))].join("="));b.push(["resumableCurrentChunkSize",encodeURIComponent(a.endByte-a.startByte)].join("="));b.push(["resumableTotalSize",encodeURIComponent(a.fileObjSize)].join("="));b.push(["resumableType",encodeURIComponent(a.fileObjType)].join("="));b.push(["resumableIdentifier",encodeURIComponent(a.fileObj.uniqueIdentifier)].join("="));b.push(["resumableFilename",encodeURIComponent(a.fileObj.fileName)].join("="));b.push(["resumableRelativePath",encodeURIComponent(a.fileObj.relativePath)].join("="));b.push(["resumableTotalChunks",encodeURIComponent(a.fileObj.chunks.length)].join("="));a.xhr.open("GET",c.getTarget(b));a.xhr.timeout=a.getOpt("xhrTimeout");a.xhr.withCredentials=a.getOpt("withCredentials");c.each(a.getOpt("headers"),function(b,c){a.xhr.setRequestHeader(b,c)});a.xhr.send(null)};a.preprocessFinished=function(){a.preprocessState=2;a.send()};a.send=function(){var g=a.getOpt("preprocess");if(typeof g==="function")switch(a.preprocessState){case 0:g(a);a.preprocessState=1;return;case 1:return}if(a.getOpt("testChunks")&&!a.tested){a.test();return}a.xhr=new XMLHttpRequest;a.xhr.upload.addEventListener("progress",function(b){if(new Date-a.lastProgressCallback>a.getOpt("throttleProgressCallbacks")*1e3){a.callback("progress");a.lastProgressCallback=new Date}a.loaded=b.loaded||0},false);a.loaded=0;a.pendingRetry=false;a.callback("progress");var f=function(){var b=a.status();if(b=="success"||b=="error"){a.callback(b,a.message());a.resumableObj.uploadNextChunk()}else{a.callback("retry",a.message());a.abort();a.retries++;var c=a.getOpt("chunkRetryInterval");if(c!==undefined){a.pendingRetry=true;setTimeout(a.send,c)}else a.send()}};a.xhr.addEventListener("load",f,false);a.xhr.addEventListener("error",f,false);var e={resumableChunkNumber:a.offset+1,resumableChunkSize:a.getOpt("chunkSize"),resumableCurrentChunkSize:a.endByte-a.startByte,resumableTotalSize:a.fileObjSize,resumableType:a.fileObjType,resumableIdentifier:a.fileObj.uniqueIdentifier,resumableFilename:a.fileObj.fileName,resumableRelativePath:a.fileObj.relativePath,resumableTotalChunks:a.fileObj.chunks.length},d=a.getOpt("query");if(typeof d=="function")d=d(a.fileObj,a);c.each(d,function(a,b){e[a]=b});var k=a.fileObj.file.slice?"slice":a.fileObj.file.mozSlice?"mozSlice":a.fileObj.file.webkitSlice?"webkitSlice":"slice",j=a.fileObj.file[k](a.startByte,a.endByte),b=null,i=a.getOpt("target");if(a.getOpt("method")==="octet"){b=j;var h=[];c.each(e,function(a,b){h.push([encodeURIComponent(a),encodeURIComponent(b)].join("="))});i=c.getTarget(h)}else{b=new FormData;c.each(e,function(a,c){b.append(a,c)});b.append(a.getOpt("fileParameterName"),j)}a.xhr.open("POST",i);a.xhr.timeout=a.getOpt("xhrTimeout");a.xhr.withCredentials=a.getOpt("withCredentials");c.each(a.getOpt("headers"),function(b,c){a.xhr.setRequestHeader(b,c)});a.xhr.send(b)};a.abort=function(){a.xhr&&a.xhr.abort();a.xhr=null};a.status=function(b){if(a.offset<b)return"success";if(a.pendingRetry)return"uploading";else if(!a.xhr)return"pending";else if(a.xhr.readyState<4)return"uploading";else if(a.xhr.status==200)return"success";else if(c.contains(a.getOpt("permanentErrors"),a.xhr.status)||a.retries>=a.getOpt("maxChunkRetries"))return"error";else{a.abort();return"pending"}};a.message=function(){return a.xhr?a.xhr.responseText:""};a.progress=function(b,d){if(typeof b==="undefined")b=false;var c=b?(a.endByte-a.startByte)/a.fileObjSize:1;if(a.pendingRetry)return 0;var e=a.status(d);switch(e){case"success":case"error":return 1*c;case"pending":return 0*c;default:return a.loaded/(a.endByte-a.startByte)*c}};return this}b.uploadNextChunk=function(){var a=false;if(b.getOpt("prioritizeFirstAndLastChunk")){c.each(b.files,function(b){if(b.chunks.length&&b.chunks[0].status()=="pending"&&b.chunks[0].preprocessState===0){b.chunks[0].send();a=true;return false}if(b.chunks.length>1&&b.chunks[b.chunks.length-1].status()=="pending"&&b.chunks[b.chunks.length-1].preprocessState===0){b.chunks[b.chunks.length-1].send();a=true;return false}});if(a)return true}c.each(b.files,function(b){if(b.isPaused()===false)for(var c=b.startchunkindex;c<b.chunks.length;c++)if(b.chunks[c].status()=="pending"&&b.chunks[c].preprocessState===0){b.chunks[c].send();a=true;return false}if(a)return false});if(a)return true;var d=false;c.each(b.files,function(a){if(!a.isComplete()){d=true;return false}});!d&&b.fire("complete");return false};b.assignBrowse=function(a,e){if(typeof a.length=="undefined")a=[a];c.each(a,function(c){var a;if(c.tagName==="INPUT"&&c.type==="file")a=c;else{a=document.createElement("input");a.setAttribute("type","file");a.style.display="none";c.addEventListener("click",function(){a.style.opacity=0;a.style.display="block";a.focus();a.click();a.style.display="none"},false);c.appendChild(a)}var f=b.getOpt("maxFiles");if(typeof f==="undefined"||f!=1)a.setAttribute("multiple","multiple");else a.removeAttribute("multiple");if(e)a.setAttribute("webkitdirectory","webkitdirectory");else a.removeAttribute("webkitdirectory");a.addEventListener("change",function(a){d(a.target.files,a);a.target.value=""},false)})};b.assignDrop=function(a){if(typeof a.length=="undefined")a=[a];c.each(a,function(a){a.addEventListener("dragover",g,false);a.addEventListener("drop",h,false)})};b.unAssignDrop=function(a){if(typeof a.length=="undefined")a=[a];c.each(a,function(a){a.removeEventListener("dragover",g);a.removeEventListener("drop",h)})};b.isUploading=function(){var a=false;c.each(b.files,function(b){if(b.isUploading()){a=true;return false}});return a};b.upload=function(){if(b.isUploading())return;b.fire("uploadStart");for(var a=1;a<=b.getOpt("simultaneousUploads");a++)b.uploadNextChunk()};b.pause=function(){c.each(b.files,function(a){a.abort()});b.fire("pause")};b.cancel=function(){for(var a=b.files.length-1;a>=0;a--)b.files[a].cancel();b.fire("cancel")};b.progress=function(){var d=0,a=0;c.each(b.files,function(b){d+=b.progress()*b.size;a+=b.size});return a>0?d/a:0};b.addFile=function(b,a){d([b],a)};b.removeFile=function(c){for(var a=b.files.length-1;a>=0;a--)b.files[a]===c&&b.files.splice(a,1)};b.getFromUniqueIdentifier=function(d){var a=false;c.each(b.files,function(b){if(b.uniqueIdentifier==d)a=b});return a};b.getSize=function(){var a=0;c.each(b.files,function(b){a+=b.size});return a};return this};window.Resumable=a})()})