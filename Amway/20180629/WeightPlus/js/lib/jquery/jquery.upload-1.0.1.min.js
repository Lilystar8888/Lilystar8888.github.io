(function(a){typeof define==="function"&&define.amd?define(["jquery","extend","exif","megapix"],a):a(jQuery)})(function(){$.fn.upload=function(c){var a=$.extend({},c,$.fn.upload.settings),b=null;$("#fileupload").length==0&&$('<input id="fileupload" type="file" />').attr("accept",a.accept).css({position:"absolute",top:a.top}).appendTo("body");$("#fileupload").on("change",function(e){if(e.target.files.length==0)return;var d=e.target.files[0],c=new FileReader;c.onload=function(){var e=EXIF.readFromBinaryFile(new BinaryFile(this.result));mpImg=new MegaPixImage(d);var c=new Image;c.onload=function(){b&&$(b).trigger($.fn.upload.events.UPLOAD_CHANGE,[c])};mpImg.render(c,$.extend({orientation:e.Orientation},a))};c.readAsText(d)});return this.each(function(){var c=this;$(this).on(a.bindingEvent,function(){b=this;$("#fileupload").trigger("click")})})};$.fn.upload.settings={bindingEvent:window.CLICK?window.CLICK:"click",accept:"image/*",top:"-9999px",maxWidth:undefined,maxHeight:undefined,width:undefined,height:undefined};$.fn.upload.events={UPLOAD_CHANGE:"upload:change"}})