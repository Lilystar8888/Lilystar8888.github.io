define("echarts/chart/pie","require ./base zrender/shape/Text zrender/shape/Ring zrender/shape/Circle zrender/shape/Sector zrender/shape/Polyline ../config ../util/ecData zrender/tool/util zrender/tool/math zrender/tool/color ../chart".split(" "),function(t){function D(a,f,e,b,c){F.call(this,a,f,e,b,c);var d=this;d.shapeHandler.onmouseover=function(a){a=a.target;var b=r.get(a,"seriesIndex"),c=r.get(a,"dataIndex"),e=r.get(a,"special"),f=[a.style.x,a.style.y],h=((a.style.endAngle+a.style.startAngle)/
2+360)%360,l=a.highlightStyle.color;(e=d.getLabel(b,c,e,f,h,l,!0))&&d.zr.addHoverShape(e);(a=d.getLabelLine(b,c,f,a.style.r0,a.style.r,h,l,!0))&&d.zr.addHoverShape(a)};this.refresh(b)}var F=t("./base"),G=t("zrender/shape/Text"),H=t("zrender/shape/Ring"),I=t("zrender/shape/Circle"),J=t("zrender/shape/Sector"),K=t("zrender/shape/Polyline"),C=t("../config");C.pie={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockWise:!0,startAngle:90,minAngle:0,selectedOffset:10,
itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1,type:"solid"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!1},labelLine:{show:!1,length:20,lineStyle:{width:1,type:"solid"}}}}};var r=t("../util/ecData"),A=t("zrender/tool/util"),y=t("zrender/tool/math"),L=t("zrender/tool/color");return D.prototype={type:C.CHART_TYPE_PIE,_buildShape:function(){var a=this.series,f=this.component.legend;
this.selectedMap={};this._selected={};var e;this._selectedMode=!1;for(var b,c=0,d=a.length;d>c;c++)if(a[c].type===C.CHART_TYPE_PIE&&(a[c]=this.reformOption(a[c]),this.legendHoverLink=a[c].legendHoverLink||this.legendHoverLink,b=a[c].name||"",this.selectedMap[b]=f?f.isSelected(b):!0,this.selectedMap[b])){var l=this.parseCenter(this.zr,a[c].center);var g=this.parseRadius(this.zr,a[c].radius);this._selectedMode=this._selectedMode||a[c].selectedMode;this._selected[c]=[];this.deepQuery([a[c],this.option],
"calculable")&&(e={zlevel:a[c].zlevel,z:a[c].z,hoverable:!1,style:{x:l[0],y:l[1],r0:10>=g[0]?0:g[0]-10,r:g[1]+10,brushType:"stroke",lineWidth:1,strokeColor:a[c].calculableHolderColor||this.ecTheme.calculableHolderColor||C.calculableHolderColor}},r.pack(e,a[c],c,void 0,-1),this.setCalculable(e),e=10>=g[0]?new I(e):new H(e),this.shapeList.push(e));this._buildSinglePie(c);this.buildMark(c)}this.addShapeList()},_buildSinglePie:function(a){for(var f,e=this.series[a],b=e.data,c=this.component.legend,d=
0,l=0,g=0,n=Number.NEGATIVE_INFINITY,m=[],k=0,h=b.length;h>k;k++)f=b[k].name,this.selectedMap[f]=c?c.isSelected(f):!0,this.selectedMap[f]&&!isNaN(b[k].value)&&(0!==+b[k].value?d++:l++,g+=+b[k].value,n=Math.max(n,+b[k].value));if(0!==g){var q,p,z,x,u,v=100,w=e.clockWise,B=(e.startAngle.toFixed(2)-0+360)%360,r=e.minAngle||.01;l=360-r*d-.01*l;var E=e.roseType;k=0;for(h=b.length;h>k;k++)if(f=b[k].name,this.selectedMap[f]&&!isNaN(b[k].value)){if(d=c?c.getColor(f):this.zr.getColor(k),v=b[k].value/g,q="area"!=
E?w?B-v*l-(0!==v?r:.01):v*l+B+(0!==v?r:.01):w?B-360/h:360/h+B,q=q.toFixed(2)-0,v=(100*v).toFixed(2),p=this.parseCenter(this.zr,e.center),z=this.parseRadius(this.zr,e.radius),x=+z[0],u=+z[1],"radius"===E?u=b[k].value/n*(u-x)*.8+.2*(u-x)+x:"area"===E&&(u=Math.sqrt(b[k].value/n)*(u-x)+x),w){var t=B;B=q;q=t}this._buildItem(m,a,k,v,b[k].selected,p,x,u,B,q,d);w||(B=q)}this._autoLabelLayout(m,p,u);k=0;for(h=m.length;h>k;k++)this.shapeList.push(m[k])}},_buildItem:function(a,f,e,b,c,d,l,g,n,m,k){var h=this.series,
q=((m+n)/2+360)%360;c=this.getSector(f,e,b,c,d,l,g,n,m,k);r.pack(c,h[f],f,h[f].data[e],e,h[f].data[e].name,b);a.push(c);c=this.getLabel(f,e,b,d,q,k,!1);(d=this.getLabelLine(f,e,d,l,g,q,k,!1))&&(r.pack(d,h[f],f,h[f].data[e],e,h[f].data[e].name,b),a.push(d));c&&(r.pack(c,h[f],f,h[f].data[e],e,h[f].data[e].name,b),c._labelLine=d,a.push(c))},getSector:function(a,f,e,b,c,d,l,g,n,m){e=this.series[a];var k=e.data[f],h=[k,e],q=this.deepMerge(h,"itemStyle.normal")||{},p=this.deepMerge(h,"itemStyle.emphasis")||
{};m=this.getItemStyleColor(q.color,a,f,k)||m;var z=this.getItemStyleColor(p.color,a,f,k)||("string"==typeof m?L.lift(m,-.2):m);c={zlevel:e.zlevel,z:e.z,clickable:this.deepQuery(h,"clickable"),style:{x:c[0],y:c[1],r0:d,r:l,startAngle:g,endAngle:n,brushType:"both",color:m,lineWidth:q.borderWidth,strokeColor:q.borderColor,lineJoin:"round"},highlightStyle:{color:z,lineWidth:p.borderWidth,strokeColor:p.borderColor,lineJoin:"round"},_seriesIndex:a,_dataIndex:f};b?(b=((c.style.startAngle+c.style.endAngle)/
2).toFixed(2)-0,c.style._hasSelected=!0,c.style._x=c.style.x,c.style._y=c.style.y,d=this.query(e,"selectedOffset"),c.style.x+=y.cos(b,!0)*d,c.style.y-=y.sin(b,!0)*d,this._selected[a][f]=!0):this._selected[a][f]=!1;return this._selectedMode&&(c.onclick=this.shapeHandler.onclick),this.deepQuery([k,e,this.option],"calculable")&&(this.setCalculable(c),c.draggable=!0),(this._needLabel(e,k,!0)||this._needLabelLine(e,k,!0))&&(c.onmouseover=this.shapeHandler.onmouseover),new J(c)},getLabel:function(a,f,e,
b,c,d,l){var g=this.series[a],n=g.data[f];if(this._needLabel(g,n,l)){var m,k,h,q=l?"emphasis":"normal",p=A.merge(A.clone(n.itemStyle)||{},g.itemStyle);l=p[q].label;var z=l.textStyle||{},x=b[0],u=b[1];b=this.parseRadius(this.zr,g.radius);l.position=l.position||p.normal.label.position;"center"===l.position?(m=x,k=u,h="center"):"inner"===l.position||"inside"===l.position?(b=(b[0]+b[1])*(l.distance||.5),m=Math.round(x+b*y.cos(c,!0)),k=Math.round(u-b*y.sin(c,!0)),d="#fff",h="center"):(b=b[1]- -p[q].labelLine.length,
m=Math.round(x+b*y.cos(c,!0)),k=Math.round(u-b*y.sin(c,!0)),h=90<=c&&270>=c?"right":"left");"center"!=l.position&&"inner"!=l.position&&"inside"!=l.position&&(m+="left"===h?20:-20);n.__labelX=m-("left"===h?5:-5);n.__labelY=k;e=new G({zlevel:g.zlevel,z:g.z+1,hoverable:!1,style:{x:m,y:k,color:z.color||d,text:this.getLabelText(a,f,e,q),textAlign:z.align||h,textBaseline:z.baseline||"middle",textFont:this.getFont(z)},highlightStyle:{brushType:"fill"}});return e._radius=b,e._labelPosition=l.position||"outer",
e._rect=e.getRect(e.style),e._seriesIndex=a,e._dataIndex=f,e}},getLabelText:function(a,f,e,b){var c=this.series[a],d=c.data[f];return(b=this.deepQuery([d,c],"itemStyle."+b+".label.formatter"))?"function"==typeof b?b.call(this.myChart,{seriesIndex:a,seriesName:c.name||"",series:c,dataIndex:f,data:d,name:d.name,value:d.value,percent:e}):"string"==typeof b?(b=b.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}"),b.replace("{a0}",c.name).replace("{b0}",d.name).replace("{c0}",
d.value).replace("{d0}",e)):void 0:d.name},getLabelLine:function(a,f,e,b,c,d,l,g){b=this.series[a];var n=b.data[f];if(this._needLabelLine(b,n,g)){g=g?"emphasis":"normal";var m=A.merge(A.clone(n.itemStyle)||{},b.itemStyle)[g].labelLine;g=m.lineStyle||{};var k=e[0];e=e[1];m=this.parseRadius(this.zr,b.radius)[1]- -m.length;var h=y.cos(d,!0);d=y.sin(d,!0);return new K({zlevel:b.zlevel,z:b.z+1,hoverable:!1,style:{pointList:[[k+c*h,e-c*d],[k+m*h,e-m*d],[n.__labelX,n.__labelY]],strokeColor:g.color||l,lineType:g.type,
lineWidth:g.width},_seriesIndex:a,_dataIndex:f})}},_needLabel:function(a,f,e){return this.deepQuery([f,a],"itemStyle."+(e?"emphasis":"normal")+".label.show")},_needLabelLine:function(a,f,e){return this.deepQuery([f,a],"itemStyle."+(e?"emphasis":"normal")+".labelLine.show")},_autoLabelLayout:function(a,f,e){for(var b=[],c=[],d=0,l=a.length;l>d;d++)("outer"===a[d]._labelPosition||"outside"===a[d]._labelPosition)&&(a[d]._rect._y=a[d]._rect.y,a[d]._rect.x<f[0]?b.push(a[d]):c.push(a[d]));this._layoutCalculate(b,
f,e,-1);this._layoutCalculate(c,f,e,1)},_layoutCalculate:function(a,f,e,b){function c(b,c,e){for(var f=b;c>f;f++)if(a[f]._rect.y+=e,a[f].style.y+=e,a[f]._labelLine&&(a[f]._labelLine.style.pointList[1][1]+=e,a[f]._labelLine.style.pointList[2][1]+=e),f>b&&c>f+1&&a[f+1]._rect.y>a[f]._rect.y+a[f]._rect.height)return void d(f,e/2);d(c-1,e/2)}function d(b,d){for(var c=b;0<=c&&(a[c]._rect.y-=d,a[c].style.y-=d,a[c]._labelLine&&(a[c]._labelLine.style.pointList[1][1]-=d,a[c]._labelLine.style.pointList[2][1]-=
d),!(0<c&&a[c]._rect.y>a[c-1]._rect.y+a[c-1]._rect.height));c--);}function l(a,c,b,d,e){var f=b[0];b=b[1];for(var h=c?Number.MAX_VALUE:0,g=0,l=a.length;l>g;g++){var k=Math.abs(a[g]._rect.y-b);var m=a[g]._radius-d;k=d+m>k?Math.sqrt((d+m+20)*(d+m+20)-Math.pow(a[g]._rect.y-b,2)):Math.abs(a[g]._rect.x+(0<e?0:a[g]._rect.width)-f);c&&k>=h&&(k=h-10);!c&&h>=k&&(k=h+10);a[g]._rect.x=a[g].style.x=f+k*e;a[g]._labelLine&&(a[g]._labelLine.style.pointList[2][0]=f+(k-5)*e,a[g]._labelLine.style.pointList[1][0]=f+
(k-20)*e);h=k}}a.sort(function(a,b){return a._rect.y-b._rect.y});var g=0;for(var n=a.length,m=[],k=[],h=0;n>h;h++)g=a[h]._rect.y-g,0>g&&c(h,n,-g,b),g=a[h]._rect.y+a[h]._rect.height;0>this.zr.getHeight()-g&&d(n-1,g-this.zr.getHeight());for(h=0;n>h;h++)a[h]._rect.y>=f[1]?k.push(a[h]):m.push(a[h]);l(k,!0,f,e,b);l(m,!1,f,e,b)},reformOption:function(a){var f=A.merge;return a=f(f(a||{},A.clone(this.ecTheme.pie||{})),A.clone(C.pie)),a.itemStyle.normal.label.textStyle=this.getTextStyle(a.itemStyle.normal.label.textStyle),
a.itemStyle.emphasis.label.textStyle=this.getTextStyle(a.itemStyle.emphasis.label.textStyle),this.z=a.z,this.zlevel=a.zlevel,a},refresh:function(a){a&&(this.option=a,this.series=a.series);this.backupShapeList();this._buildShape()},addDataAnimation:function(a,f){function e(){g--;0===g&&f&&f()}for(var b=this.series,c={},d=0,l=a.length;l>d;d++)c[a[d][0]]=a[d];var g=0,n={},m={},k={},h=this.shapeList;this.shapeList=[];var q={};d=0;for(l=a.length;l>d;d++){var p=a[d][0];var r=a[d][2];var t=a[d][3];b[p]&&
b[p].type===C.CHART_TYPE_PIE&&(r?(t||(n[p+"_"+b[p].data.length]="delete"),q[p]=1):t?q[p]=0:(n[p+"_-1"]="delete",q[p]=-1),this._buildSinglePie(p))}var u,v;d=0;for(l=this.shapeList.length;l>d;d++)switch(p=this.shapeList[d]._seriesIndex,u=this.shapeList[d]._dataIndex,v=p+"_"+u,this.shapeList[d].type){case "sector":n[v]=this.shapeList[d];break;case "text":m[v]=this.shapeList[d];break;case "polyline":k[v]=this.shapeList[d]}this.shapeList=[];var w;d=0;for(l=h.length;l>d;d++)if((p=h[d]._seriesIndex,c[p])&&
(u=h[d]._dataIndex+q[p],v=p+"_"+u,w=n[v],w))if("sector"===h[d].type)"delete"!=w?(g++,this.zr.animate(h[d].id,"style").when(400,{startAngle:w.style.startAngle,endAngle:w.style.endAngle}).done(e).start()):(g++,this.zr.animate(h[d].id,"style").when(400,0>q[p]?{startAngle:h[d].style.startAngle}:{endAngle:h[d].style.endAngle}).done(e).start());else if("text"===h[d].type||"polyline"===h[d].type)if("delete"===w)this.zr.delShape(h[d].id);else switch(h[d].type){case "text":g++;w=m[v];this.zr.animate(h[d].id,
"style").when(400,{x:w.style.x,y:w.style.y}).done(e).start();break;case "polyline":g++,w=k[v],this.zr.animate(h[d].id,"style").when(400,{pointList:w.style.pointList}).done(e).start()}this.shapeList=h;g||f&&f()},onclick:function(a){var f=this.series;if(this.isClick&&a.target){this.isClick=!1;for(var e,b=a.target,c=b.style,d=r.get(b,"seriesIndex"),l=r.get(b,"dataIndex"),g=0,n=this.shapeList.length;n>g;g++)if(this.shapeList[g].id===b.id){if(d=r.get(b,"seriesIndex"),l=r.get(b,"dataIndex"),c._hasSelected)b.style.x=
b.style._x,b.style.y=b.style._y,b.style._hasSelected=!1,this._selected[d][l]=!1;else{var m=((c.startAngle+c.endAngle)/2).toFixed(2)-0;b.style._hasSelected=!0;this._selected[d][l]=!0;b.style._x=b.style.x;b.style._y=b.style.y;e=this.query(f[d],"selectedOffset");b.style.x+=y.cos(m,!0)*e;b.style.y-=y.sin(m,!0)*e}this.zr.modShape(b.id)}else this.shapeList[g].style._hasSelected&&"single"===this._selectedMode&&(d=r.get(this.shapeList[g],"seriesIndex"),l=r.get(this.shapeList[g],"dataIndex"),this.shapeList[g].style.x=
this.shapeList[g].style._x,this.shapeList[g].style.y=this.shapeList[g].style._y,this.shapeList[g].style._hasSelected=!1,this._selected[d][l]=!1,this.zr.modShape(this.shapeList[g].id));this.messageCenter.dispatch(C.EVENT.PIE_SELECTED,a.event,{selected:this._selected,target:r.get(b,"name")},this.myChart);this.zr.refreshNextFrame()}}},A.inherits(D,F),t("../chart").define("pie",D),D});